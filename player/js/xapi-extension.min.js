"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3577],{3863:(e,t)=>{t.XAPI_LOAD_WRAPPER="XAPI_LOAD_WRAPPER",t.XAPI_SET_ACTIVE="XAPI_SET_ACTIVE",t.XAPI_LOAD_STATE="XAPI_LOAD_STATE",t.XAPI_TRACKABLE_CHANGE="XAPI_TRACKABLE_CHANGE",t.xapiLoadWrapper=()=>({type:t.XAPI_LOAD_WRAPPER}),t.xapiSetActive=e=>({type:t.XAPI_SET_ACTIVE,payload:e}),t.xapiLoadState=()=>({type:t.XAPI_LOAD_STATE}),t.xapiTrackableChange=e=>({type:t.XAPI_TRACKABLE_CHANGE,payload:e})},79037:(e,t,a)=>{var i=a(39322),n=a(28761);const o=a(72579),{setAppReadyState:r,setLearner:s,DATA_READY:c}=a(63444),{TRACKABLE_CHANGE:p}=a(59828),{COMPONENT_COMPLETED:l}=a(29933),{setTracking:d,getTrackingImmediately:b}=a(84491),{xapiLoadWrapper:A,xapiSetActive:_,xapiLoadState:g,xapiTrackableChange:E,XAPI_LOAD_WRAPPER:u,XAPI_LOAD_STATE:v,XAPI_TRACKABLE_CHANGE:f}=a(3863),m=a(8267),x="TRACKING_DATA";let T,C,S=(new Date).getTime();function O(e,t){T.getState(e,{callback:(e,a)=>{t(e,a)}})}function P(e,t,a){T.setState(e,t,{contentType:"application/json",overwriteJSON:!0,callback:(e,t)=>{a(e,t)}})}function y(e,t){const{course:a,components:n}=t,o=n[e],r=o.displayTitle||o.title,s=i(`<div>${r}</div>`).text();let c=m.interacted;return o._isQuestionType&&(c=m.answered),{object:{id:`http://evolve/${a._id}/${o._id}`,definition:{name:{"en-US":s}}},verb:c}}function I(e,t){const{course:a}=e,n=t._status;if("incomplete"===n)return null;const o=i(`<div>${a.title}</div>`).text(),r={completion:!0,duration:C((new Date).getTime()-S)};return"passed"!==n&&"failed"!==n||(r.success="passed"===n),r.score={raw:t._score,min:0,max:100},{object:{id:`http://evolve/${a._id}`,definition:{name:{"en-US":o}}},verb:m.completed,result:r}}t.xapiSetupEpic=(e,t)=>e.filter((e=>{if(e.type!==c)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled})).mergeMap((()=>n.Observable.concat(n.Observable.of(r("xapi",!1)),n.Observable.of(A())))),t.xapiLoadWrapperEpic=(e,t)=>e.filter((({type:e})=>{if(e!==u)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled})).mergeMap((()=>{const{app:e,course:a,_xapi:r}=t.getState(),c=e.isLivePreview?"../../../public/player/":"";return n.Observable.bindCallback(i.getScript)(`${c}libraries/tincan.js`).mergeMap((()=>{const e=i(`<div>${a.title}</div>`).text(),t=[];if(r._useEndPoint){const{endpoint:e,key:a,secret:i}=r._lrsConfig;e&&a&&i&&t.push({endpoint:e,auth:`Basic ${window.TinCan.Utils.getBase64String(`${a}:${i}`)}`})}const c={activity:{id:`http://evolve/${a._id}`,definition:{name:{"en-US":e}}},url:window.location.href.replace(window.location.hash,""),recordStores:t};T=new window.TinCan(c),C=window.TinCan.Utils.convertMillisecondsToISO8601Duration;const p=o(T,"actor.name");let l={};if(p){const e=p.split(" ");e.length&&(l={_id:p,firstName:e[0],lastName:e[1]})}const d={object:{id:`http://evolve/${a._id}`,definition:{name:{"en-US":e}}},verb:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"en-US":"initialized"}}};return n.Observable.bindCallback(T.sendStatement.bind(T))(d).mergeMap((()=>n.Observable.concat(n.Observable.of(_({isActive:!0})),n.Observable.of(g()),n.Observable.of(s(l)))))}))})).catch((e=>(console.log("xAPI wrapper failed to load",e),n.Observable.concat(n.Observable.of(_({isActive:!1})),n.Observable.of(r("xapi",!0)))))),t.xapiLoadStateEpic=(e,t)=>e.filter((e=>{if(e.type!==v)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled&&a.isActive})).mergeMap((()=>n.Observable.bindCallback(O)(x).mergeMap((([e,t])=>{if(e||!t||!t.contents)return console.log("xapi state not found"),n.Observable.of({tracking:null});if("string"==typeof t.contents)try{t.contents=JSON.parse(t.contents)}catch(e){return console.log("Error parsing XAPI state.contents: ",t.contents),n.Observable.of({tracking:null})}return S=new Date(t.contents._createdAt).getTime(),n.Observable.of({tracking:t.contents})})))).mergeMap((e=>(e.tracking&&d(e.tracking,!0),n.Observable.of(r("xapi",!0))))),t.xapiComponentCompleteEpic=(e,t)=>e.filter((e=>{if(e.type!==l)return!1;const{_xapi:a}=t.getState();return a&&a._isEnabled&&a.isActive})).mergeMap((e=>{const a=t.getState(),i=[y(e.payload.componentId,a)];return console.log("xAPI: component statement",i),n.Observable.bindCallback(T.sendStatements.bind(T))(i)})).ignoreElements().catch((e=>(console.log("xAPI tracking failed",e),n.Observable.of({type:"XAPI_ERROR",payload:e})))),t.xapiTrackableChangeEpic=(e,t)=>e.ofType(p,l).filter((()=>{const{_xapi:e}=t.getState();return e&&e._isEnabled&&e.isActive})).map((()=>E(b()))),t.xapiTrackingChangedEpic=e=>e.ofType(f).mergeMap((e=>(console.log("xAPI: tracking changed"),n.Observable.bindCallback(P)(x,e.payload)))).ignoreElements().catch((e=>(console.log("xAPI tracking failed",e),n.Observable.of({type:"XAPI_ERROR",payload:e})))),t.xapiCourseStatusChangedEpic=(e,t)=>e.ofType(f).map((({payload:e})=>({_status:e._status,_score:e._score}))).distinctUntilChanged(((e,t)=>e._status===t._status)).filter((e=>"incomplete"!==e._status)).mergeMap((e=>{const a=[I(t.getState(),e)];return console.log("xAPI: course status changed",a),n.Observable.bindCallback(T.sendStatements.bind(T))(a)})).ignoreElements().catch((e=>(console.log("xAPI tracking failed",e),n.Observable.of({type:"XAPI_ERROR",payload:e}))))},84740:(e,t,a)=>{const i=a(60019),n=a(82421),{FETCH_COURSE_DATA:o}=a(63444),{XAPI_SET_ACTIVE:r}=a(3863),s={_isEnabled:!1,isActive:!1,_useEndPoint:!1,_lrsConfig:{}};e.exports=(e=s,t)=>{if(t.type===o){const a=t.payload.config._xapi;return a&&a._isEnabled?i({},e,a):s}return e._isEnabled?t.type===r?n({},e,t.payload):e:s}},8267:e=>{e.exports={experienced:"experienced",attended:"attended",attempted:"attempted",completed:"completed",passed:"passed",failed:"failed",answered:"answered",interacted:"interacted",imported:"imported",created:"created",shared:"shared",voided:"voided"}},88222:(e,t,a)=>{const{registerReducer:i,registerEpics:n}=a(90876),o=a(84740),{xapiSetupEpic:r,xapiLoadWrapperEpic:s,xapiLoadStateEpic:c,xapiComponentCompleteEpic:p,xapiTrackableChangeEpic:l,xapiTrackingChangedEpic:d,xapiCourseStatusChangedEpic:b}=a(79037);i("_xapi",o),n(r,s,c,p,l,d,b)}}]);
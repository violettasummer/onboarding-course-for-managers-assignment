"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9723],{88515:(e,t,n)=>{var s=n(39322),o=n(14859)(n(58527));const i=n(12436),r=n(92191),a=n(79421),p=n(55281),c=n(90249),l=n(5648),m=n(58335),{bool:h,func:d,string:u,object:_}=n(13980),g=n(2784),{Component:f}=n(58720),C=n(88934),v=n(43855),b=n(96235),y=n(70913),w=m({displayName:"IFrame",propTypes:{component:_.isRequired,screenSize:u.isRequired,styles:_,isPageReady:h,setComponentAsReady:d.isRequired,setComponentAsViewed:d.isRequired,setComponentAsComplete:d.isRequired},getInitialState:()=>({_height:null}),componentDidMount(){window.addEventListener("resize",this.onWindowResize),"content"===this.props.component._setCompletionOn&&this.createMessageChannel()},componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),this.closeMessageChannel()},UNSAFE_componentWillReceiveProps({screenSize:e,component:t}){e!==this.props.screenSize&&this.props.component._isReady&&this.setIframeHeight(),t._setCompletionOn!==this.props.component._setCompletionOn&&("content"===t._setCompletionOn?(this.createMessageChannel(),this.setupIframeCommunication()):this.closeMessageChannel())},onWindowResize:i((function(){this.setIframeHeight(!0)}),100),onIFrameLoaded(){this.setIframeHeight(),this.props.setComponentAsReady(this.props.component._id),"content"===this.props.component._setCompletionOn&&this.setupIframeCommunication()},createMessageChannel(){this._channel=new MessageChannel},closeMessageChannel(){this._channel&&(this._channel.port1.close(),this._channel.port2.close(),this._channel=null)},setupIframeCommunication(){var e;this._channel.port1.onmessage=e=>{var t,n;return["completed","complete"].includes(null===(t=(n=e.data).toLowerCase)||void 0===t?void 0:t.call(n))?this.props.setComponentAsComplete(this.props.component._id):null},null===(e=this._iframe)||void 0===e||e.contentWindow.postMessage("Evolve calling!","*",[this._channel.port2])},setIframeHeight(e=!1){const t=()=>this.setState({_height:this.getIframeHeight()});if(e)return t();setTimeout(t,400)},getIframeHeight(){const{_iframeHeightSelector:e}=this.props.component;let t=0;if(e)return t=s(this._iframe).contents().find(e).height(),t;try{const e=this._iframe.contentDocument||this._iframe.contentWindow.document,{body:n,documentElement:s}=e;t=Math.max(n.scrollHeight,n.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight)}catch(e){}return t},onVisibilityChange(...e){const t="content"===this.props.component._setCompletionOn?this.props.setComponentAsViewed:this.props.setComponentAsComplete;v(...e,this,t)},getAttributes(){var e;const{component:t}=this.props;return t._isEmbeddedFile?{src:y(t._embed)}:null!==(e=t._source)&&void 0!==e&&e.includes("</iframe>")?this.extractAttributesFromSource(t._source):{src:t._source}},extractAttributesFromSource(e){if(!e)return;const t=s(s.parseHTML(e.trim()));if(!t.length||!t.is("iframe"))return;var n;if(!this.props.component._useIframeAttributes)return{src:null===(n=p(t[0].attributes,{name:"src"}))||void 0===n?void 0:n.value};const o={};return a(t[0].attributes,(e=>{if("style"===e.name){const t=e.value.split(";");return o.style={},void a(t,(e=>{if(!e)return;let[t,n]=e.split(/:(.+)/);t=r(t).trim().camelCase().replace("-","").value(),n=l(n),o.style[t]=n}))}o[e.name]=e.value})),o},getStyle(){const{state:e,props:t}=this,{screenSize:n,component:s}=t,o={width:"100%"};return s._isHeightBasedOnContent&&e._height?(o.height=e._height,o):(o.height="small"===n?`${s._frameHeight._mobile}px`:`${s._frameHeight._desktop}px`,o)},renderIframe(){const e=this.getAttributes();if(null==e||!e.src)return;e.style||(e.style=this.getStyle());const{component:t}=this.props;return t._useIframeAttributes&&!t._isEmbeddedFile||(e.allow="camera; microphone"),g.createElement("iframe",(0,o.default)({key:c(e).length,title:t.iFrameTitle,ref:e=>this._iframe=e,onLoad:this.onIFrameLoaded},e))},render(){const{props:e}=this,t="content"===e.component._setCompletionOn;return g.createElement(f,{component:e.component,styles:e.styles,onVisibilityChange:this.onVisibilityChange,isVisibilitySensorActive:C(e,t?"_isComplete":"_hasBeenViewed")},g.createElement("div",{className:b(e.component)},this.renderIframe()))}});e.exports=w},515:(e,t,n)=>{const{registerComponent:s}=n(90876);s("iFrame",{component:n(88515),trackingMap:n(21322)})},21322:e=>{e.exports={_interactionType:{type:"String",default:"presentation",shouldRestore:!1}}},88934:e=>{e.exports=(e,t="_hasBeenViewed")=>{const{component:n,isPageReady:s}=e;return!0===s&&!0===n._isReady&&!0!==n[t]}},96235:(e,t,n)=>{const s=n(72779);e.exports=e=>s(`ev-${e._component}-widget ev-component-widget ev-clearfix`,{"ev-disabled":!e._isEnabled,"ev-complete ev-show-user-answer":e._isComplete&&!e._isEnabled,"ev-correct":e._isCorrect&&!e._isEnabled,"ev-submitted":e._isSubmitted})},43855:e=>{e.exports=function(e,t,n,s,o){s&&s.props&&s.props.component?(t.top&&(s.isInviewTop=!0),t.bottom&&(s.isInviewBottom=!0),s.isInviewTop&&s.isInviewBottom&&o&&o(s.props.component._id)):console.error("No component reference passed to helpers/visibilityChangeHandler")}}}]);
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7232],{63062:(e,t)=>{t.TRACKER_LOAD_DATA="TRACKER_LOAD_DATA",t.TRACKER_SAVE_SESSION="TRACKER_SAVE_SESSION",t.SET_TRACKER_AUTH="SET_TRACKER_AUTH",t.SAVE_TRACKER_DONE="SAVE_TRACKER_DONE",t.trackerLoadData=e=>({type:t.TRACKER_LOAD_DATA,payload:e}),t.trackerSaveSession=e=>({type:t.TRACKER_SAVE_SESSION,payload:e}),t.setTrackerAuth=e=>({type:t.SET_TRACKER_AUTH,payload:e}),t.saveTrackingDone=e=>({type:t.SAVE_TRACKER_DONE,payload:e})},87862:(e,t,r)=>{var a=r(39322);const{Observable:o}=r(28761),c=r(2784),{ajax:n}=r(90221),i=r(90876),l=r(58335),{addElement:s}=r(51777),{adjustNavigationHeight:p}=r(75758),{COMPONENT_COMPLETED:d,COMPONENT_TRACKABLE_CHANGE:_}=r(29933),{TRACKABLE_CHANGE:E}=r(59828),{WINDOW_UNLOAD:u,WINDOW_BEFORE_UNLOAD:k}=r(36498),{DATA_READY:A,APP_STARTED:T,setAppReadyState:g,setLearner:f}=r(63444),{setTracking:S,getTrackingImmediately:v}=r(84491),R=r(2462),{trackerLoadData:m,trackerSaveSession:C,setTrackerAuth:y,saveTrackingDone:D,TRACKER_LOAD_DATA:O,TRACKER_SAVE_SESSION:b,SET_TRACKER_AUTH:N}=r(63062),h=[d,_,T,u,b,E];let w=null;function L(e,t){var r;const{config:a,tracker:c}=t.getState();return"exceed"!==(null===(r=a._tracker)||void 0===r?void 0:r._platform)?o.empty():function(e,t,r){if(!r)return o.empty();const a=`${t._pushData}/${w}`;return n.put(a,e,{"Content-Type":"application/json"}).catch((e=>(console.error("tracker:error",e),o.empty())))}(e,a._tracker,c.authenticated)}t.trackerSetupEpic=(e,t)=>e.filter((e=>{var r;if(e.type!==A)return!1;const{app:a,config:o}=t.getState();return!a.isLivePreview&&(null===(r=o._tracker)||void 0===r?void 0:r._isEnabled)})).take(1).mergeMap((()=>o.of(g("tracker",!1),m()))).catch((e=>(console.error("tracker:error",e),g("tracker",!0)))),t.trackerLoadDataEpic=(e,t)=>e.ofType(O).mergeMap((()=>{const{config:e}=t.getState();return"exceed"!==e._tracker._platform?o.empty():function(e,t){const{inline:r}=t.getState(),a=function(e,t){var r;if(t)return null===(r=window.evolve)||void 0===r?void 0:r.courseId;e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const a=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}("_courseId",null==r?void 0:r.isEnabled);return a||window.location.replace("/404"),o.forkJoin(n.getJSON(`${e._auth}?course_id=${a}`),n.getJSON("/monitor/heartbeat")).mergeMap((([e,t])=>{if(e.authenticated){const r=1e3*t,a=(new Date).getTime();return window.TIME_DIFFERENCE=a-r,o.of(f({_id:e.user_id,firstName:e.first_name,lastName:e.last_name,userData:e}),y(e))}return o.of(y({authenticated:!1}))})).catch((e=>console.error("tracker:error",e)))}(e._tracker,t)})),t.trackerTrackableActionEpic=(e,t)=>e.filter((e=>{var r;if(!h.includes(e.type))return!1;const{app:a,config:o}=t.getState();return!a.isLivePreview&&(null===(r=o._tracker)||void 0===r?void 0:r._isEnabled)})).do((({type:e})=>console.log("tracker:trigger",e))).debounce((({type:e})=>{const t=e===b?0:5e3;return o.timer(t)})).takeUntil(e.ofType(u,k)).switchMap((()=>L(v(),t).catch((e=>(console.error("tracker:error",e),o.empty()))))).map((()=>D())).do((()=>console.info("tracker:saved"))),t.trackerCourseCompletionEpic=(e,t)=>e.filter((e=>{var r;if(!h.includes(e.type))return!1;const{app:a,config:o}=t.getState();return!a.isLivePreview&&(null===(r=o._tracker)||void 0===r?void 0:r._isEnabled)})).map((()=>R(t.getState()))).distinctUntilChanged().filter((e=>e)).do((()=>console.info("tracker:track:completed"))).takeUntil(e.ofType(u,k)).mergeMap((()=>L(v(),t).catch((e=>(console.error("tracker:error",e),o.empty()))))).map((()=>D())).do((()=>console.info("tracker:savedCompletion"))),t.trackerWindowUnloadEpic=(e,t)=>e.ofType(u,k).take(1).filter((()=>{var e;const{app:r,config:a,inline:o}=t.getState(),c=null==o?void 0:o.isEnabled;return!r.isLivePreview&&c&&(null===(e=a._tracker)||void 0===e?void 0:e._isEnabled)})).mergeMap((()=>L(v(),t))).map((()=>D())),t.trackerLoadTrackingEpic=(e,t)=>e.ofType(N).mergeMap((()=>{const{config:e}=t.getState();return"exceed"!==e._tracker._platform?o.empty():function(e){const{config:t,tracker:r}=e.getState();if(r.authenticated&&r.enrollment_course_activity_id&&r.user_id){w=r.enrollment_course_activity_id;const d=`/evolve/api/v1/enrollment_course_activities/${w}/decorator.js`;return o.bindCallback(a.getScript)(d).mergeMap((()=>{if(window.EXCEED_API)return o.bindCallback(window.EXCEED_API.init)({store:e,actions:{addElement:s,adjustNavigationHeight:p,trackerSaveSession:C},libraries:{React:c,Observable:o,createReactClass:l},player:i})})).mergeMap((()=>{const e=`${t._tracker._getData}/${w}`;return n.getJSON(e)})).mergeMap((e=>(S(e,!0),o.of(g("tracker",!0)))))}return o.of(g("tracker",!0))}(t)}))},51563:(e,t,r)=>{const{FETCH_COURSE_DATA:a}=r(63444),{SET_TRACKER_AUTH:o}=r(63062),c={_isEnabled:!1,_auth:{}};e.exports=(e=c,t)=>t.type===a&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?{...e,_isEnabled:!0}:e._isEnabled?t.type===o?{...e,...t.payload}:e:c},98622:(e,t,r)=>{const{registerEpics:a,registerReducer:o}=r(90876),c=r(51563),{trackerWindowUnloadEpic:n,trackerSetupEpic:i,trackerLoadDataEpic:l,trackerLoadTrackingEpic:s,trackerTrackableActionEpic:p,trackerCourseCompletionEpic:d}=r(87862);o("tracker",c),a(n,i,l,s,p,d)}}]);